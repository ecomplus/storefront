<script>
  document.addEventListener("DOMContentLoaded", function (event) {
    const scriptUrl =
      "<%- options.widgetSrc || 'https://unpkg.com/@martan-app/widgets-js@1.1.20/dist/martan.umd.js' %>"
    const page = "<%- _.route.resource %>"

    const isEnabled = "<%- options.widget_rating && options.widget_rating.is_enabled %>"

    const startWidget = () => {
      const color = "<%- options.widget_rating && options.widget_rating.star_color || '#000' %>"
      const fontSize = "<%- options.widget_rating && options.widget_rating.font_size || 14 %>"

      const storeId = "<%- options.store_id %>"
      const widgetKey = "<%- options.widget_key %>"
      const webId = "<%- options.web_id %>"

      const $reviewsTarget =
        "<%- options.martanReviewsTarget || 'reviews_widget' %>"
      const $questionsTarget =
        "<%- options.martanQuestionsTarget || 'martan_questions_widget' %>"

      const reviewsIsEnabled = "<%- options.showWidgetReviews %>"
      const questionsIsEnabled = "<%- options.showWidgetQuestions %>"

      const martan = new window.Martan({
        storeId: parseInt(storeId, 10),
        widgetKey,
        webId,
        sandbox: true
      })

      setTimeout(() => {
        try {
          if (isEnabled) {
            martan
              .average({
                fontSize,
                color,
              })
              .start()
          }
        } catch (error) { }
      }, 50)
    }

    if (isEnabled) {
      const script = document.createElement("script")
      script.setAttribute("src", scriptUrl)
      script.setAttribute("id", "martan-scripts")
      script.async = true
      document.body.appendChild(script)
      script.onload = startWidget
    }
  })
</script>
