<div class="product-block my-4 mb-lg-5">
  <div class="container">
    <section id="product" class="product">
      <!--
        `TheProduct` should be rendered (hydrated) here:
        https://developers.e-com.plus/storefront/@ecomplus/storefront-components/docs/TheProduct.html
      -->

      <div class="row" data-to-render="true">
        <div class="col-12 col-md-6 mb-4">
          <!-- Picture(s) gallery will be inserted dynamically within `TheProduct` -->
          <% if (_.state.pictures) { %>
            <% const imgObj = _.ecomUtils.img(_.state, null, 'big') %>
            <% if (imgObj) { %>
              <div data-slot="first-picture">
                <picture class="product__picture">
                  <source
                    srcset="<%= _.ecomUtils.img(_.state).url %>"
                    type="image/webp"
                    media="(max-width: 399.98px)"
                  >
                  <source
                    srcset="<%= imgObj.url %>"
                    type="image/webp"
                    media="(min-width: 400px)"
                  >
                  <img
                    src="<%= imgObj.url.replace(/\.webp$/, '') %>"
                    alt="<%= imgObj.alt %>"
                  >
                </picture>
              </div>
            <% } %>
          <% } %>

          <div data-slot="gallery-footer">
            <!-- Custom additional code on bottom of images gallery -->
          </div>
        </div>

        <div class="col">
          <div data-slot="heading">
            <h1 class="product__name">
              <%= _.ecomUtils.name(_.state) %>
            </h1>
            <p class="product__sku">
              COD: <%= _.state.sku %>
            </p>
          </div>

          <% if (_.state.available && _.state.visible && _.ecomUtils.inStock(_.state)) { %>
            <div class="product__price prices prices--big">
              <strong class="prices__value">
                <%= _.ecomUtils.formatMoney(_.ecomUtils.price(_.state)) %>
              </strong>
            </div>
          <% } %>

          <% if (_.state.variations && _.state.variations.length) { %>
            <div data-slot="variations-info">
              <!-- Custom info for products with variations, such as sizes table link -->
            </div>
          <% } %>

          <div class="spinner-border m-4" role="status">
            <span class="sr-only">Loading...</span>
          </div>

          <div class="product__buy">
            <button
              type="button"
              class="btn btn-lg btn-primary"
              onclick="ecomCart.addProduct(storefront.context.body)"
              <% if (_.state.variations && _.state.variations.length) { %>
                disabled
              <% } %>
            >
              <div data-slot="buy-button-content">
                <i class="fas fa-shopping-bag mr-1"></i>
                <%= _.dictionary('buy') %>
              </div>
            </button>
          </div>

          <% if (_.state.short_description) { %>
            <div data-slot="short-description">
              <p class="product__info lead">
                <%= _.state.short_description %>
              </p>
            </div>
          <% } %>
        </div>
      </div>
    </section>
  </div>
</div>

<%
const productJsonLd = {
  '@context': 'http://schema.org',
  '@type': 'Product',
  sku: _.state.sku,
  description: _.state.short_description || _.state.meta_description || _.ecomUtils.name(_.state),
  name: _.ecomUtils.name(_.state),
  offers: {
    '@type': 'Offer',
    url: `https://${_.settings.domain}/${_.state.slug}`,
    availability: `${(_.ecomUtils.inStock(_.state) ? 'In' : 'OutOf')}Stock`,
    priceCurrency: _.settings.currency,
    price: _.ecomUtils.price(_.state),
    itemCondition: `http://schema.org/${(_.state.condition === 'new' ? 'New' : 'Used')}Condition`,
    seller: {
      '@type': 'Organization',
      name: _.settings.name || _.store.name
    }
  }
}
if (_.state.brands && _.state.brands[0]) {
  productJsonLd.brand = {
    '@type': 'Brand',
    name: _.state.brands[0].name
  }
}
if (_.state.pictures && _.state.pictures.length) {
  productJsonLd.image = _.ecomUtils.img(_.state, null, 'zoom').url
}
if (_.state.mpn && _.state.mpn[0]) {
  productJsonLd.mpn = _.state.mpn[0]
}
%>
<script type="application/ld+json"><%-
  JSON.stringify(productJsonLd)
%></script>
